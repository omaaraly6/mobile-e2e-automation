name: Run Maestro Flows on iOS

on:
  push:
    branches:
      - master

jobs:
  maestro-test-ios:
    runs-on: macos-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Homebrew
        run: |
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

      - name: Install Facebook IDB
        run: brew install facebook/fb/idb-companion

      - name: Install Maestro CLI
        run: |
          curl -Ls https://get.maestro.mobile.dev | bash
          sudo mv $HOME/.maestro/bin/maestro /usr/local/bin/maestro
          which maestro
          maestro --version

      - name: Start iOS Simulator
        run: xcrun simctl boot "iPhone 15"

      - name: Run Maestro Flow
        run: maestro test .
